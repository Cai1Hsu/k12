function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[263],{y8qK:function(e,t,n){"use strict";n.r(t);var r,i,a=n("ofXK"),s=n("3Pt+"),o=n("TEn/"),c=n("tyNb"),u=n("mrSG"),h=n("Npln"),l=n("wd/R"),d=n("qXBG"),f=n("jMEw"),m=n("LWQN"),p=n("26ZW"),v=n("B7Rs"),y=n("FAH8"),k=n("tk/3"),b=n("AytR"),_=n("te5A"),w=n("h2Q0"),x=n("fXoL"),g=n("90iM"),I=[{path:"",component:(r=function(){function e(t,n,r,i,a,s,o,c,u,d,f){var m=this;_classCallCheck(this,e),this.route=t,this.auth=n,this.ymsrv=r,this.transfer=i,this.file=a,this.platform=s,this.comm=o,this.osrv=c,this.pickController=u,this.fileOpener=d,this.utility=f,this.the_filter=new h.a,this.the_eduyear=[],this.fileTransfer=this.transfer.create(),t.paramMap.subscribe((function(e){m.the_filter.the_date=l().format("YYYY-MM-DD"),e.has("teacherid")&&(m.the_filter.teacherid=e.get("teacherid")),e.has("studentid")&&(m.the_filter.studentid=e.get("studentid"))}))}return _createClass(e,[{key:"ngOnInit",value:function(){this.init()}},{key:"init",value:function(){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.auth.get_user();case 2:return this.user=e.sent,e.next=5,this.initSemester();case 5:if(this.isStudent=this.the_filter.studentid&&""!=this.the_filter.studentid,!0!==this.isStudent){e.next=11;break}return e.next=9,this.initStudent();case 9:e.next=13;break;case 11:return e.next=13,this.initTeacher();case 13:return this.platform.is("ios")||this.utility.checkPermission(),e.next=16,this.file.createDir(this.file.dataDirectory,b.a.root_directory,!0);case 16:case"end":return e.stop()}}),e,this)})))}},{key:"initTeacher",value:function(){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.osrv.get_teacher(this.the_filter.teacherid);case 2:0==(t=e.sent).code&&(this.the_eduyear=t.data.grades,this.fileName=t.data.name);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"initStudent",value:function(){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.osrv.get_student(this.the_filter.studentid);case 2:0==(t=e.sent).code&&(this.the_eduyear=[t.data.grade],this.fileName=t.data.name);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"initSemester",value:function(){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ymsrv.get_current_semester(this.user.serialNo);case 2:0==(t=e.sent).code&&t.data&&0!=t.data.length&&(this.the_semester=t.data[0]);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"down",value:function(){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.the_eduyear.length){e.next=14;break}if(!(this.the_eduyear.length>1)){e.next=10;break}return t=[],n=[],this.the_eduyear.forEach((function(e){n.push({text:e.name,value:e.serialNo})})),t.push({name:"1",options:n}),e.next=7,this.pickController.create({buttons:[{role:"cancel",text:"\u53d6\u6d88",handler:function(){}},{text:"\u786e\u5b9a",handler:function(e){r.download(r.the_eduyear.find((function(t){return t.serialNo==e[1].value})))}}],columns:t});case 7:e.sent.present(),e.next=12;break;case 10:return e.next=12,this.download(this.the_eduyear[0]);case 12:e.next=15;break;case 14:this.comm.presentToast("\u6570\u636e\u9519\u8bef\uff01");case 15:case"end":return e.stop()}}),e,this)})))}},{key:"download",value:function(e){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i,a,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n="",r=new k.f({fromObject:{semester:this.the_semester.serialNo,eduyear:e.serialNo,teacherId:this.the_filter.teacherid||"",student:this.the_filter.studentid||""}}),i=encodeURI(b.a.ym_endpoint+b.a.schedule_flow+"/weektable/print?"+r.toString()),1==this.platform.is("ios")){t.next=18;break}return t.next=7,this.utility.checkPermission();case 7:if(t.t0=t.sent,1==t.t0){t.next=10;break}return t.abrupt("return",void this.comm.presentToast("\u4f60\u672a\u540c\u610f\u5728\u624b\u673a\u4e2d\u5b58\u50a8\u6587\u4ef6\uff0c\u65e0\u6cd5\u4e0b\u8f7d\uff01"));case 10:return t.next=12,this.file.createDir(this.file.dataDirectory,b.a.root_directory+"/timetable",!0);case 12:t.t1=t.sent.toURL(),t.t2=this.fileName,t.t3=t.t1+t.t2,n=t.t3+"\u7684\u8bfe\u8868.pdf",t.next=19;break;case 18:n=this.file.documentsDirectory+this.fileName+"\u7684\u8bfe\u8868.pdf";case 19:return t.next=21,this.auth.get_token();case 21:a=t.sent,this.comm.loadingPresent("\u6b63\u5728\u4e0b\u8f7d\u8bfe\u8868....."),this.fileTransfer.download(i,n,!1,{headers:{Authorization:"Bearer "+a}}).then((function(e){s.comm.loadingDismiss(),s.comm.presentAlertConfirm("\u6e29\u99a8\u63d0\u793a","\u5468\u8bfe\u8868\u4e0b\u8f7d\u6210\u529f\uff01\u662f\u5426\u9a6c\u4e0a\u6253\u5f00\uff1f",[{text:"\u4e0d\u4e86",handler:function(){}},{text:"\u9a6c\u4e0a\u6253\u5f00",handler:function(){s.fileOpener.showOpenWithDialog(e.nativeURL,"application/pdf")}}])})).catch((function(e){s.comm.presentToast("\u4e0b\u8f7d\u5931\u8d25\uff01")})),t.next=28;break;case 25:t.prev=25,t.t4=t.catch(0),this.comm.presentToast("\u4e0b\u8f7d\u5931\u8d25,\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\uff01");case 28:case"end":return t.stop()}}),t,this,[[0,25]])})))}}]),e}(),r.\u0275fac=function(e){return new(e||r)(x["\u0275\u0275directiveInject"](c.a),x["\u0275\u0275directiveInject"](d.a),x["\u0275\u0275directiveInject"](f.a),x["\u0275\u0275directiveInject"](v.a),x["\u0275\u0275directiveInject"](y.a),x["\u0275\u0275directiveInject"](o.Platform),x["\u0275\u0275directiveInject"](m.a),x["\u0275\u0275directiveInject"](p.a),x["\u0275\u0275directiveInject"](o.PickerController),x["\u0275\u0275directiveInject"](_.a),x["\u0275\u0275directiveInject"](w.a))},r.\u0275cmp=x["\u0275\u0275defineComponent"]({type:r,selectors:[["app-display-timetable"]],decls:11,vars:1,consts:[["slot","start"],["defaultHref","tabs"],["slot","end"],[3,"click"],[3,"filter"]],template:function(e,t){1&e&&(x["\u0275\u0275elementStart"](0,"ion-header"),x["\u0275\u0275elementStart"](1,"ion-toolbar"),x["\u0275\u0275elementStart"](2,"ion-buttons",0),x["\u0275\u0275element"](3,"ion-back-button",1),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](4,"ion-title"),x["\u0275\u0275text"](5,"\u8bfe\u8868"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](6,"ion-buttons",2),x["\u0275\u0275elementStart"](7,"ion-button",3),x["\u0275\u0275listener"]("click",(function(){return t.down()})),x["\u0275\u0275text"](8,"\u4e0b\u8f7d"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](9,"ion-content"),x["\u0275\u0275element"](10,"app-list-timetable-one-day",4),x["\u0275\u0275elementEnd"]()),2&e&&(x["\u0275\u0275advance"](10),x["\u0275\u0275property"]("filter",t.the_filter))},directives:[o.IonHeader,o.IonToolbar,o.IonButtons,o.IonBackButton,o.IonBackButtonDelegate,o.IonTitle,o.IonButton,o.IonContent,g.a],styles:[""]}),r)}],j=((i=function e(){_classCallCheck(this,e)}).\u0275mod=x["\u0275\u0275defineNgModule"]({type:i}),i.\u0275inj=x["\u0275\u0275defineInjector"]({factory:function(e){return new(e||i)},imports:[[c.i.forChild(I)],c.i]}),i),C=n("Ql/B");n.d(t,"DisplayTimetablePageModule",(function(){return S}));var R,S=((R=function e(){_classCallCheck(this,e)}).\u0275mod=x["\u0275\u0275defineNgModule"]({type:R}),R.\u0275inj=x["\u0275\u0275defineInjector"]({factory:function(e){return new(e||R)},imports:[[a.CommonModule,s.FormsModule,o.IonicModule,j,C.a]]}),R)}}]);