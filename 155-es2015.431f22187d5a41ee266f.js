(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{x57r:function(e,t,n){"use strict";n.r(t);var o=n("ofXK"),i=n("3Pt+"),r=n("TEn/"),a=n("tyNb"),l=n("mrSG"),c=n("qXBG"),m=n("aBxd"),s=n("D+jN"),d=n("LWQN"),h=n("rttL"),p=n("uwyt"),u=n("26ZW"),f=n("AytR"),_=n("fXoL"),v=n("Xj7U"),y=n("ZVAZ"),g=n("ZE2D");const x=["comment_content"];function I(e,t){if(1&e&&(_["\u0275\u0275elementStart"](0,"div",19),_["\u0275\u0275element"](1,"app-resource-video-viewer",20),_["\u0275\u0275elementEnd"]()),2&e){const e=_["\u0275\u0275nextContext"](2);_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("src",e.the_url)("isLive",e.isLive)}}function b(e,t){if(1&e){const e=_["\u0275\u0275getCurrentView"]();_["\u0275\u0275elementStart"](0,"div",21),_["\u0275\u0275elementStart"](1,"ion-item",22),_["\u0275\u0275elementStart"](2,"ion-thumbnail",23),_["\u0275\u0275element"](3,"img",8),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](4,"ion-input",24,25),_["\u0275\u0275listener"]("ngModelChange",(function(t){return _["\u0275\u0275restoreView"](e),_["\u0275\u0275nextContext"](2).the_comment_submit.comments=t})),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](6,"ion-button",26),_["\u0275\u0275listener"]("click",(function(){return _["\u0275\u0275restoreView"](e),_["\u0275\u0275nextContext"](2).create_comment()})),_["\u0275\u0275text"](7,"\u53d1\u5e03"),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"]()}if(2&e){const e=_["\u0275\u0275nextContext"](2);_["\u0275\u0275advance"](3),_["\u0275\u0275property"]("src",e.user.avatarUrl,_["\u0275\u0275sanitizeUrl"]),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngModel",e.the_comment_submit.comments)("placeholder",e.the_place_holder)}}function C(e,t){if(1&e){const e=_["\u0275\u0275getCurrentView"]();_["\u0275\u0275elementStart"](0,"a",31),_["\u0275\u0275listener"]("click",(function(){_["\u0275\u0275restoreView"](e);const t=_["\u0275\u0275nextContext"]().$implicit;return _["\u0275\u0275nextContext"](2).reply(t)})),_["\u0275\u0275text"](1,"\u56de\u590d"),_["\u0275\u0275elementEnd"]()}}function E(e,t){if(1&e){const e=_["\u0275\u0275getCurrentView"]();_["\u0275\u0275elementStart"](0,"a",32),_["\u0275\u0275listener"]("click",(function(){_["\u0275\u0275restoreView"](e);const t=_["\u0275\u0275nextContext"]().$implicit;return _["\u0275\u0275nextContext"](2).delete(t,null)})),_["\u0275\u0275text"](1,"\u5220\u9664"),_["\u0275\u0275elementEnd"]()}}function S(e,t){if(1&e&&(_["\u0275\u0275elementStart"](0,"span"),_["\u0275\u0275text"](1,"\xa0\u56de\u590d\xa0"),_["\u0275\u0275elementStart"](2,"span",36),_["\u0275\u0275text"](3),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"]()),2&e){const e=_["\u0275\u0275nextContext"](2).$implicit;_["\u0275\u0275advance"](3),_["\u0275\u0275textInterpolate"](e.replyTeacherName)}}function w(e,t){if(1&e){const e=_["\u0275\u0275getCurrentView"]();_["\u0275\u0275elementStart"](0,"a",32),_["\u0275\u0275listener"]("click",(function(){_["\u0275\u0275restoreView"](e);const t=_["\u0275\u0275nextContext"](2).$implicit,n=_["\u0275\u0275nextContext"](2).$implicit;return _["\u0275\u0275nextContext"](2).delete(t,n)})),_["\u0275\u0275text"](1,"\u5220\u9664"),_["\u0275\u0275elementEnd"]()}}function z(e,t){if(1&e&&(_["\u0275\u0275elementStart"](0,"nz-comment",27),_["\u0275\u0275element"](1,"nz-avatar",28),_["\u0275\u0275elementStart"](2,"nz-comment-content"),_["\u0275\u0275elementStart"](3,"p"),_["\u0275\u0275template"](4,S,4,1,"span",3),_["\u0275\u0275text"](5),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](6,"nz-comment-action"),_["\u0275\u0275template"](7,w,2,0,"a",30),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"]()),2&e){const e=_["\u0275\u0275nextContext"]().$implicit,t=_["\u0275\u0275nextContext"](4);_["\u0275\u0275property"]("nzAuthor",e.comment_by.name)("nzDatetime",e.creation_time),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("nzSrc",e.avatar),_["\u0275\u0275advance"](3),_["\u0275\u0275property"]("ngIf",e.replyTeacherName),_["\u0275\u0275advance"](1),_["\u0275\u0275textInterpolate1"](" ",e.comments," "),_["\u0275\u0275advance"](2),_["\u0275\u0275property"]("ngIf",e.comment_by.id===t.user.userCode)}}function k(e,t){if(1&e&&(_["\u0275\u0275elementContainerStart"](0),_["\u0275\u0275template"](1,z,8,6,"nz-comment",35),_["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit;_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngIf",!0===e.show)}}function j(e,t){if(1&e){const e=_["\u0275\u0275getCurrentView"]();_["\u0275\u0275elementStart"](0,"a",37),_["\u0275\u0275listener"]("click",(function(){_["\u0275\u0275restoreView"](e);const t=_["\u0275\u0275nextContext"](2).$implicit;return _["\u0275\u0275nextContext"](2).load_child_more(t)})),_["\u0275\u0275text"](1),_["\u0275\u0275elementEnd"]()}if(2&e){const e=_["\u0275\u0275nextContext"](2).$implicit;_["\u0275\u0275advance"](1),_["\u0275\u0275textInterpolate1"]("\u5171",e.reply.length,"\u6761\u56de\u590d>")}}function T(e,t){if(1&e&&(_["\u0275\u0275elementContainerStart"](0),_["\u0275\u0275template"](1,k,2,1,"ng-container",33),_["\u0275\u0275template"](2,j,2,1,"a",34),_["\u0275\u0275elementContainerEnd"]()),2&e){const e=_["\u0275\u0275nextContext"]().$implicit;_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngForOf",e.reply),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngIf",!0===e.showMore)}}function O(e,t){if(1&e&&(_["\u0275\u0275elementStart"](0,"nz-comment",27),_["\u0275\u0275element"](1,"nz-avatar",28),_["\u0275\u0275elementStart"](2,"nz-comment-content"),_["\u0275\u0275elementStart"](3,"p"),_["\u0275\u0275text"](4),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](5,"nz-comment-action"),_["\u0275\u0275template"](6,C,2,0,"a",29),_["\u0275\u0275template"](7,E,2,0,"a",30),_["\u0275\u0275elementEnd"](),_["\u0275\u0275template"](8,T,3,2,"ng-container",3),_["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=_["\u0275\u0275nextContext"](2);_["\u0275\u0275property"]("nzAuthor",e.comment_by.name)("nzDatetime",e.creation_time),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("nzSrc",e.avatar),_["\u0275\u0275advance"](3),_["\u0275\u0275textInterpolate1"](" ",e.comments," "),_["\u0275\u0275advance"](2),_["\u0275\u0275property"]("ngIf",!0===n.can_reply),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngIf",e.comment_by.id===n.user.userCode),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngIf",e.reply&&e.reply.length>0)}}function V(e,t){if(1&e){const e=_["\u0275\u0275getCurrentView"]();_["\u0275\u0275elementStart"](0,"div",38),_["\u0275\u0275elementStart"](1,"a",39),_["\u0275\u0275listener"]("click",(function(){return _["\u0275\u0275restoreView"](e),_["\u0275\u0275nextContext"](2).moreComment()})),_["\u0275\u0275text"](2,"\u67e5\u770b\u66f4\u591a\u8bc4\u8bba"),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"]()}}function D(e,t){if(1&e&&(_["\u0275\u0275elementStart"](0,"ion-content"),_["\u0275\u0275template"](1,I,2,2,"div",4),_["\u0275\u0275elementStart"](2,"div",5),_["\u0275\u0275elementStart"](3,"ion-grid"),_["\u0275\u0275elementStart"](4,"ion-row"),_["\u0275\u0275elementStart"](5,"ion-col",6),_["\u0275\u0275elementStart"](6,"ion-thumbnail",7),_["\u0275\u0275element"](7,"img",8),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](8,"ion-col",9),_["\u0275\u0275elementStart"](9,"a",10),_["\u0275\u0275text"](10),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](11,"ion-row"),_["\u0275\u0275elementStart"](12,"ion-col",11),_["\u0275\u0275elementStart"](13,"a",12),_["\u0275\u0275text"](14),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](15,"ion-col",13),_["\u0275\u0275elementStart"](16,"a",14),_["\u0275\u0275text"](17),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275template"](18,b,8,3,"div",15),_["\u0275\u0275elementStart"](19,"div",5),_["\u0275\u0275elementStart"](20,"a",16),_["\u0275\u0275text"](21),_["\u0275\u0275elementEnd"](),_["\u0275\u0275template"](22,O,9,7,"nz-comment",17),_["\u0275\u0275template"](23,V,3,0,"div",18),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"]()),2&e){const e=_["\u0275\u0275nextContext"]();_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngIf",e.the_url),_["\u0275\u0275advance"](6),_["\u0275\u0275property"]("src",e.the_record.avatar,_["\u0275\u0275sanitizeUrl"]),_["\u0275\u0275advance"](3),_["\u0275\u0275textInterpolate"](e.the_record.title),_["\u0275\u0275advance"](4),_["\u0275\u0275textInterpolate"](e.the_record.teacher),_["\u0275\u0275advance"](3),_["\u0275\u0275textInterpolate"](e.the_record.dateTime),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngIf",!0===e.can_reply&&e.user),_["\u0275\u0275advance"](3),_["\u0275\u0275textInterpolate1"]("\u5168\u90e8\u8bc4\u4ef7\uff08",e.the_comment_total,"\uff09"),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngForOf",e.the_comment_list),_["\u0275\u0275advance"](1),_["\u0275\u0275property"]("ngIf",e.the_comment_total>e.the_comment_list.length)}}const M=[{path:"",component:(()=>{class e{constructor(e,t,n,o,i,r){this.cache=e,this.lplp=t,this.lpsrv=n,this.comm=o,this.osrv=i,this.auth=r,this.isLive=!1,this.the_comment_submit=new m.b,this.the_place_holder="\u8bf7\u8f93\u5165\u8bc4\u8bba\u7684\u5185\u5bb9",this.the_comment_total=0,this.the_comment_list=[],this.the_comment_filter=new m.a}ngOnInit(){this.init()}init(){return Object(l.a)(this,void 0,void 0,(function*(){this.the_token=yield this.lplp.Token(),this.user=yield this.auth.get_user(),this.comm.loadingPresent(),this.the_record=yield this.cache.get("livingRecorded"),this.the_record.videoType==m.e.Live&&(this.isLive=!0);let e=yield this.auth.is_admin();if(this.can_reply=e,1!=e){this.the_setting=yield this.auth.get_setting(this.user.serialNo);let e=yield this.auth.get_userType();this.can_reply=!0===this.the_setting.isOpenCoursePlanReply&&this.the_setting.coursePlanReplUserType.filter(t=>t===e).length>0}yield this.initTeacher(),yield this.initVideo(),yield this.initComment(),this.comm.loadingDismiss()}))}initTeacher(){return Object(l.a)(this,void 0,void 0,(function*(){let e=yield this.osrv.get_teacher(this.the_record.teacherId);0==e.code&&(e.data.avatar_url&&""!=e.data.avatar_url||(e.data.avatar_url=f.a.default_avatar),this.the_record.avatar=e.data.avatar_url)}))}initVideo(){return Object(l.a)(this,void 0,void 0,(function*(){let e=yield this.lpsrv.get_ondemand_data(this.the_record.id,this.the_token);0==e.code&&(this.the_url=e.data)}))}initComment(){return Object(l.a)(this,void 0,void 0,(function*(){this.the_comment_filter=new m.a,this.the_comment_filter.videoId=this.the_record.id,this.the_comment_list=yield this.loadCommentData()}))}loadCommentData(){return Object(l.a)(this,void 0,void 0,(function*(){let e=yield this.lpsrv.get_course_plan_comment(this.the_comment_filter,this.the_token);if(0==e.code){for(let t=0;t<e.data.length;t++){let n=e.data[t];n.reply=yield this.formatComment(n)}return e.data.forEach(e=>{""!=e.avatar&&null!=e.avatar||(e.avatar=f.a.default_avatar),e.reply&&(e.reply.forEach(e=>{""!=e.avatar&&null!=e.avatar||(e.avatar=f.a.default_avatar)}),e.reply.length>5?(e.showMore=!0,e.reply.forEach((e,t)=>{e.show=!(t>=5)})):e.reply.forEach(e=>e.show=!0),e.reply=e.reply.sort((e,t)=>new Date(e.creation_time).getTime()-new Date(t.creation_time).getTime()))}),this.the_comment_total=e.count,e.data}}))}formatComment(e){return Object(l.a)(this,void 0,void 0,(function*(){let t=[];if(e.reply&&e.reply.length>0){t=e.reply;for(let o=0;o<e.reply.length;o++){let i=e.reply[o];if(i.reply&&i.reply.length>0){var n=yield this.formatComment(i);n.forEach(e=>e.replyTeacherName=i.comment_by.name),t=t.concat(n)}}}return t}))}load_child_more(e){return Object(l.a)(this,void 0,void 0,(function*(){let t=1|e.showIndex;t+=1,e.reply.filter(e=>1!=e.show).forEach((e,n)=>{e.show=n<5*t}),e.showMore=e.reply.filter(e=>1!=e.show).length>0}))}create_comment(){return Object(l.a)(this,void 0,void 0,(function*(){if(this.the_comment_submit.videoId=this.the_record.id,!this.the_comment_submit.comments||""==this.the_comment_submit.comments)return void this.comm.presentToast("\u8bf7\u8f93\u5165\u8bc4\u8bba\uff01");let e;this.comm.loadingPresent(),e=this.the_comment_submit.commentId&&""!=this.the_comment_submit.commentId?yield this.lpsrv.reply_course_plan_comment(this.the_comment_submit,this.the_token):yield this.lpsrv.create_course_plan_comment(this.the_comment_submit,this.the_token),this.comm.loadingDismiss(),0==e.code?(this.the_comment_submit=new m.b,this.the_place_holder="\u8bf7\u8f93\u5165\u8bc4\u8bba\u7684\u5185\u5bb9",yield this.initComment()):this.comm.presentToast(e.msg)}))}moreComment(){return Object(l.a)(this,void 0,void 0,(function*(){this.the_comment_filter.PageIndex+=1,this.the_comment_list=this.the_comment_list.concat(yield this.loadCommentData())}))}reply(e){this.the_comment_submit.commentId=e.id,this.the_place_holder="@"+e.comment_by.name+":",this.comment_content.setFocus()}delete(e,t){return Object(l.a)(this,void 0,void 0,(function*(){this.comm.presentAlertConfirm("\u6e29\u99a8\u63d0\u793a","\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8be5\u8bc4\u8bba\u5417\uff1f",[{text:"\u53d6\u6d88",role:"cancel",hanlder:()=>{}},{text:"\u786e\u5b9a",handler:()=>Object(l.a)(this,void 0,void 0,(function*(){let n=yield this.lpsrv.delete_course_plan_comment([e.id],this.the_token);0==n.code?t?t.reply.splice(t.reply.findIndex(t=>t.id==e.id),1):(this.the_comment_list.splice(this.the_comment_list.findIndex(t=>t.id==e.id),1),this.the_comment_total-=1):this.comm.presentToast(n.msg)}))}])}))}}return e.\u0275fac=function(t){return new(t||e)(_["\u0275\u0275directiveInject"](s.a),_["\u0275\u0275directiveInject"](h.a),_["\u0275\u0275directiveInject"](p.a),_["\u0275\u0275directiveInject"](d.a),_["\u0275\u0275directiveInject"](u.a),_["\u0275\u0275directiveInject"](c.a))},e.\u0275cmp=_["\u0275\u0275defineComponent"]({type:e,selectors:[["app-course-plan-detail"]],viewQuery:function(e,t){var n;1&e&&_["\u0275\u0275viewQuery"](x,!0),2&e&&_["\u0275\u0275queryRefresh"](n=_["\u0275\u0275loadQuery"]())&&(t.comment_content=n.first)},decls:7,vars:1,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","tabs"],[4,"ngIf"],["class","bgfff",4,"ngIf"],[1,"bgfff","padding-20"],["size","2"],[1,"avatar"],[1,"avatar-image",3,"src"],["size","10",1,""],[1,"font-20","color-000","text-hidden-2"],["size","2",1,"text-center"],[1,"color-000","font-16"],["size","10"],[1,"font-18","color-8f92a1"],["class","bgfff mt20",4,"ngIf"],[1,"b","font-20","color-1d1d1f"],[3,"nzAuthor","nzDatetime",4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"bgfff"],[3,"src","isLive"],[1,"bgfff","mt20"],["lines","none"],["slot","start",1,"avatar"],[1,"reply-input",3,"ngModel","placeholder","ngModelChange"],["comment_content",""],["size","default",3,"click"],[3,"nzAuthor","nzDatetime"],["nz-comment-avatar","",3,"nzSrc"],["class","mr10 color-999 font-14",3,"click",4,"ngIf"],["class","mr10 color-999 font-16",3,"click",4,"ngIf"],[1,"mr10","color-999","font-14",3,"click"],[1,"mr10","color-999","font-16",3,"click"],[4,"ngFor","ngForOf"],["class","font-16 color-blue",3,"click",4,"ngIf"],[3,"nzAuthor","nzDatetime",4,"ngIf"],[1,"color-blue"],[1,"font-16","color-blue",3,"click"],[1,"text-center"],[1,"more-comment",3,"click"]],template:function(e,t){1&e&&(_["\u0275\u0275elementStart"](0,"ion-header",0),_["\u0275\u0275elementStart"](1,"ion-toolbar"),_["\u0275\u0275elementStart"](2,"ion-buttons",1),_["\u0275\u0275element"](3,"ion-back-button",2),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementStart"](4,"ion-title"),_["\u0275\u0275text"](5,"\u89c6\u9891\u8be6\u60c5"),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275elementEnd"](),_["\u0275\u0275template"](6,D,24,9,"ion-content",3)),2&e&&(_["\u0275\u0275advance"](6),_["\u0275\u0275property"]("ngIf",t.the_record))},directives:[r.IonHeader,r.IonToolbar,r.IonButtons,r.IonBackButton,r.IonBackButtonDelegate,r.IonTitle,o.NgIf,r.IonContent,r.IonGrid,r.IonRow,r.IonCol,r.IonThumbnail,o.NgForOf,v.a,r.IonItem,r.IonInput,r.TextValueAccessor,i.NgControlStatus,i.NgModel,r.IonButton,y.c,g.a,y.b,y.d,y.a],styles:[".reply-input[_ngcontent-%COMP%]{--padding-start:1rem!important;border:1px solid #d9d9d9;margin-left:1rem;border-radius:5px;margin-right:1rem}"]}),e})()}];let N=(()=>{class e{}return e.\u0275mod=_["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=_["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.i.forChild(M)],a.i]}),e})();var $=n("Ql/B"),F=n("8pq7"),A=n("FwiY");n.d(t,"CoursePlanDetailPageModule",(function(){return B}));let B=(()=>{class e{}return e.\u0275mod=_["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=_["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[o.CommonModule,i.FormsModule,r.IonicModule,N,F.c,F.b,F.e,F.a,F.f,A.b,y.e,g.b,$.a]]}),e})()}}]);