(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{xwpR:function(e,t,n){"use strict";n.r(t);var i=n("ofXK"),r=n("3Pt+"),o=n("TEn/"),a=n("tyNb"),l=n("mrSG"),s=n("wd/R"),d=n("qXBG"),c=n("KCVp"),h=n("aBxd"),m=n("D+jN"),u=n("LWQN"),f=n("rttL"),p=n("h2Q0"),g=n("uwyt"),_=n("26ZW"),v=n("jMEw"),y=n("fXoL"),b=n("zxQZ");function I(e,t){if(1&e&&(y["\u0275\u0275elementContainerStart"](0),y["\u0275\u0275text"](1," \xa0\xa0"),y["\u0275\u0275elementStart"](2,"span"),y["\u0275\u0275text"](3),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementContainerEnd"]()),2&e){const e=y["\u0275\u0275nextContext"]().$implicit;y["\u0275\u0275advance"](2),y["\u0275\u0275classMapInterpolate1"]("badge ",e.type_class,""),y["\u0275\u0275advance"](1),y["\u0275\u0275textInterpolate"](e.type)}}const x=function(e,t){return{"color-000":e,"color-aaa":t}};function w(e,t){if(1&e){const e=y["\u0275\u0275getCurrentView"]();y["\u0275\u0275elementStart"](0,"ion-item",7),y["\u0275\u0275listener"]("click",(function(){y["\u0275\u0275restoreView"](e);const n=t.$implicit;return y["\u0275\u0275nextContext"](2).pick(n)})),y["\u0275\u0275elementStart"](1,"div",15),y["\u0275\u0275elementStart"](2,"div",16),y["\u0275\u0275elementStart"](3,"div",17),y["\u0275\u0275elementStart"](4,"ion-thumbnail"),y["\u0275\u0275element"](5,"ion-img",18),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementStart"](6,"div",19),y["\u0275\u0275text"](7),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementStart"](8,"div",20),y["\u0275\u0275elementStart"](9,"a",21),y["\u0275\u0275text"](10),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementStart"](11,"p",22),y["\u0275\u0275elementStart"](12,"span"),y["\u0275\u0275text"](13),y["\u0275\u0275elementEnd"](),y["\u0275\u0275text"](14,"\xa0\xa0|\xa0\xa0"),y["\u0275\u0275elementStart"](15,"span"),y["\u0275\u0275text"](16),y["\u0275\u0275elementEnd"](),y["\u0275\u0275text"](17," \xa0\xa0|\xa0\xa0"),y["\u0275\u0275elementStart"](18,"span"),y["\u0275\u0275text"](19),y["\u0275\u0275elementEnd"](),y["\u0275\u0275template"](20,I,4,4,"ng-container",23),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;y["\u0275\u0275advance"](5),y["\u0275\u0275property"]("src",e.coverUrl),y["\u0275\u0275advance"](2),y["\u0275\u0275textInterpolate"](e.date),y["\u0275\u0275advance"](2),y["\u0275\u0275property"]("ngClass",y["\u0275\u0275pureFunction2"](8,x,3!=e.showType,3===e.showType)),y["\u0275\u0275advance"](1),y["\u0275\u0275textInterpolate"](e.title),y["\u0275\u0275advance"](3),y["\u0275\u0275textInterpolate"](e.teacher_name),y["\u0275\u0275advance"](3),y["\u0275\u0275textInterpolate"](e.classroom_name),y["\u0275\u0275advance"](3),y["\u0275\u0275textInterpolate"](e.num_of_day_name),y["\u0275\u0275advance"](1),y["\u0275\u0275property"]("ngIf",e.type)}}function S(e,t){if(1&e&&(y["\u0275\u0275elementContainerStart"](0),y["\u0275\u0275elementStart"](1,"ion-item-divider"),y["\u0275\u0275text"](2),y["\u0275\u0275elementEnd"](),y["\u0275\u0275template"](3,w,21,11,"ion-item",14),y["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit;y["\u0275\u0275advance"](2),y["\u0275\u0275textInterpolate1"](" ",e.day," "),y["\u0275\u0275advance"](1),y["\u0275\u0275property"]("ngForOf",e.list)}}const C=[{path:"",component:(()=>{class e{constructor(e,t,n,i,r,o,a,l,s,d){this.router=e,this.auth=t,this.comm=n,this.ymsrv=i,this.osrv=r,this.utility=o,this.lpsrv=a,this.lplp=l,this.cache=s,this.pickerController=d,this.the_filter=new c.f,this.hasMore=!0,this.loading=!0,this.the_group=[],this.the_syllabus=[],this.the_video_filter=new h.d}ngOnInit(){this.init()}init(){return Object(l.a)(this,void 0,void 0,(function*(){this.the_token=yield this.lplp.Token(),this.user=yield this.auth.get_user(),this.is_teacher=yield this.auth.is_teacher(),this.is_student=yield this.auth.is_student(),this.the_filter=new c.f,this.is_teacher?this.the_filter.teacherid=this.user.userCode:this.the_filter.studentid=this.user.userCode,this.the_filter.zixiornotzixi="2",this.the_filter.orderby=this.the_filter.eduyearid=this.the_filter.searchword=this.the_filter.courseclasscode="",yield this.load_timetable()}))}search(e){this.the_filter.PageIndex=1,this.load_timetable()}load_timetable(){return Object(l.a)(this,void 0,void 0,(function*(){this.the_group=[],this.the_filter.startTime=s(this.the_date).startOf("month").format("YYYY-MM-DD"),this.the_filter.endTime=s(this.the_date).endOf("month").format("YYYY-MM-DD"),yield this.initSyllabusList();let e=yield this.get_data();[...new Set(e.map(e=>e.the_date))].forEach(t=>{this.the_group.push({day:s(t).format("YYYY\u5e74M\u6708D\u65e5"),list:e.filter(e=>e.the_date==t)})})}))}get_data(){return Object(l.a)(this,void 0,void 0,(function*(){this.loading=!0;let e=yield this.osrv.get_courseplan_time_table_range(this.the_filter,"");if(0!=e.code)return void(this.loading=!1);var t=e.data;let n=yield this.initLivingRecordedVideo([...new Set(t.map(e=>e.teacherid))]);return t.forEach(e=>{e.coverUrl=this.utility.getCover(e.courseclass_name);let t=this.the_syllabus.find(t=>t.section==parseInt(e.num_of_day)&&t.teacherId===e.teacherid&&s(t.date).isSame(s(e.the_date),"day")),i=n.find(t=>t.teacherId==e.teacherid&&t.numOfDay==parseInt(e.num_of_day)&&s(t.startDate).isSame(s(e.the_date),"day"));e.date=s(e.starttime).format("HH:mm")+"-"+s(e.endtime).format("HH:mm"),t?(e.title=t.sequence+t.name,t.tSort>0&&(e.title+="\uff08"+t.tSort+"\uff09"),e.showType=1,e.syllabus=t):i?(i.videoType===h.e.Live?s().isBetween(s(e.starttime),s(e.endtime),"seconds","[]")?(e.type="\u76f4",e.type_class="live"):(e.type="\u672a",e.type_class="coming"):(e.type="\u5f55",e.type_class="recorded"),e.title=i.title,e.showType=2,e.video=i):(e.title=e.name,e.showType=3)}),this.loading=!1,t}))}initLivingRecordedVideo(e){return Object(l.a)(this,void 0,void 0,(function*(){if(!this.the_token)return[];if(0==e.length)return[];this.the_video_filter.teacherId=e,this.the_video_filter.startDate=this.the_filter.startTime,this.the_video_filter.endDate=this.the_filter.endTime;let t=yield this.lpsrv.get_live_recorded_list(this.the_video_filter,this.the_token);return 0!=t.code?[]:t.data}))}initSyllabusList(){return Object(l.a)(this,void 0,void 0,(function*(){if(!this.the_token)return;let e=yield this.lpsrv.get_syllabus_bydate(this.the_filter.startTime,this.the_filter.endTime,this.the_token);0==e.code&&(this.the_syllabus=e.data)}))}load_more(e){return Object(l.a)(this,void 0,void 0,(function*(){if(this.the_filter.PageIndex+=1,0==(yield this.get_data()).length)this.hasMore=!1,e.target.disabled=!0;else{let e=yield this.get_data();[...new Set(e.map(e=>e.the_date))].forEach(t=>{let n=this.the_group.find(e=>e.day==s(t).format("YYYY\u5e74M\u6708D\u65e5"));n?n.list=n.list.concat(e.filter(e=>e.the_date==t)):this.the_group.push({day:s(t).format("YYYY\u5e74M\u6708D\u65e5"),list:e.filter(e=>e.the_date==t)})})}e.target.complete()}))}pick(e){return Object(l.a)(this,void 0,void 0,(function*(){if(3!==e.showType)if(1===e.showType){if(this.is_student&&1!=e.syllabus.publicType&&3!=e.syllabus.publicType)return void this.comm.presentToast("\u5bf9\u4e0d\u8d77\uff0c\u6559\u5e08\u672a\u516c\u5f00\u8be5\u8282\u8bfe\uff0c\u65e0\u6cd5\u67e5\u770b\uff01");if(this.is_teacher&&1!=e.syllabus.publicType&&3!=e.syllabus.publicType)return void this.comm.presentToast("\u5bf9\u4e0d\u8d77\uff0c\u6559\u5e08\u672a\u516c\u5f00\u8be5\u8282\u8bfe\uff0c\u65e0\u6cd5\u67e5\u770b\uff01");this.router.navigate(["features/learning-space/syllabus-view",{id:e.syllabus.syllabusId,teacherId:e.syllabus.teacherId,courseId:e.syllabus.courseId}])}else 2===e.showType&&(this.cache.set("livingRecorded",e.video),this.router.navigate(["course-plan/course-plan-detail"]));else this.comm.presentToast("\u5bf9\u4e0d\u8d77\uff0c\u672a\u80fd\u627e\u5230\u8be5\u8282\u8bfe\u7684\u5f00\u8bfe\u4fe1\u606f\uff01")}))}openFilter(){return Object(l.a)(this,void 0,void 0,(function*(){let e=[],t=[{text:"\u5168\u90e8",value:""}];(yield this.comm.getYear()).forEach(e=>{t.push({text:e.name,value:e.id})});let n=[];for(let o=1;o<=12;o++)n.push({text:o.toString()+"\u6708",value:o.toString()});let i=0,r=0;this.the_filter.startTime&&""!=this.the_filter.startTime&&(i=t.findIndex(e=>e.value==s(this.the_filter.startTime).format("YYYY")),r=n.findIndex(e=>e.value==s(this.the_filter.startTime).format("M"))),e.push({name:"1",selectedIndex:i,options:t},{name:"2",selectedIndex:r,options:n}),(yield this.pickerController.create({buttons:[{role:"cancel",text:"\u53d6\u6d88",handler:()=>{}},{text:"\u786e\u5b9a",handler:e=>{this.the_date=s(e[1].value+"-"+e[2].value+"-01").toDate(),this.the_filter.PageIndex=1,this.load_timetable()}}],columns:e})).present()}))}}return e.\u0275fac=function(t){return new(t||e)(y["\u0275\u0275directiveInject"](a.g),y["\u0275\u0275directiveInject"](d.a),y["\u0275\u0275directiveInject"](u.a),y["\u0275\u0275directiveInject"](v.a),y["\u0275\u0275directiveInject"](_.a),y["\u0275\u0275directiveInject"](p.a),y["\u0275\u0275directiveInject"](g.a),y["\u0275\u0275directiveInject"](f.a),y["\u0275\u0275directiveInject"](m.a),y["\u0275\u0275directiveInject"](o.PickerController))},e.\u0275cmp=y["\u0275\u0275defineComponent"]({type:e,selectors:[["app-my-course"]],decls:19,vars:5,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","tabs"],[1,"display-table","bgfff"],[1,"table-cell"],["placeholder","\u8f93\u5165\u5173\u952e\u8bcd\u641c\u7d22","debounce","500",3,"animated","ngModel","ionChange","ngModelChange"],[1,"table-cell",2,"width","3rem"],[3,"click"],["aria-hidden","true",1,"icon"],[0,"xlink","href","#iconInterface58-24px"],[3,"show","loading"],[4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","\u66f4\u591a..."],[3,"click",4,"ngFor","ngForOf"],[1,"display-table"],[1,"table-cell",2,"vertical-align","top","padding-top","1rem","width","5rem"],[2,"position","relative"],[3,"src"],[1,"time"],[1,"table-cell","padding-left-20","padding-top-20"],[1,"font-20","text-hidden-2",3,"ngClass"],[1,"color-8f92a1","font-16","mt10"],[4,"ngIf"]],template:function(e,t){1&e&&(y["\u0275\u0275elementStart"](0,"ion-header",0),y["\u0275\u0275elementStart"](1,"ion-toolbar"),y["\u0275\u0275elementStart"](2,"ion-buttons",1),y["\u0275\u0275element"](3,"ion-back-button",2),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementStart"](4,"ion-title"),y["\u0275\u0275text"](5,"\u6211\u7684\u8bfe\u7a0b"),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementStart"](6,"ion-content"),y["\u0275\u0275elementStart"](7,"div",3),y["\u0275\u0275elementStart"](8,"div",4),y["\u0275\u0275elementStart"](9,"ion-searchbar",5),y["\u0275\u0275listener"]("ionChange",(function(e){return t.search(e)}))("ngModelChange",(function(e){return t.the_filter.searchword=e})),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementStart"](10,"div",6),y["\u0275\u0275elementStart"](11,"a",7),y["\u0275\u0275listener"]("click",(function(){return t.openFilter()})),y["\u0275\u0275namespaceSVG"](),y["\u0275\u0275elementStart"](12,"svg",8),y["\u0275\u0275element"](13,"use",9),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"](),y["\u0275\u0275namespaceHTML"](),y["\u0275\u0275element"](14,"app-loading-process",10),y["\u0275\u0275elementStart"](15,"ion-list"),y["\u0275\u0275template"](16,S,4,2,"ng-container",11),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementStart"](17,"ion-infinite-scroll",12),y["\u0275\u0275listener"]("ionInfinite",(function(e){return t.load_more(e)})),y["\u0275\u0275element"](18,"ion-infinite-scroll-content",13),y["\u0275\u0275elementEnd"](),y["\u0275\u0275elementEnd"]()),2&e&&(y["\u0275\u0275advance"](9),y["\u0275\u0275property"]("animated",!0)("ngModel",t.the_filter.searchword),y["\u0275\u0275advance"](5),y["\u0275\u0275property"]("show",!t.the_group||0==t.the_group.length&&0==t.loading)("loading",!0===t.loading),y["\u0275\u0275advance"](2),y["\u0275\u0275property"]("ngForOf",t.the_group))},directives:[o.IonHeader,o.IonToolbar,o.IonButtons,o.IonBackButton,o.IonBackButtonDelegate,o.IonTitle,o.IonContent,o.IonSearchbar,o.TextValueAccessor,r.NgControlStatus,r.NgModel,b.a,o.IonList,i.NgForOf,o.IonInfiniteScroll,o.IonInfiniteScrollContent,o.IonItemDivider,o.IonItem,o.IonThumbnail,o.IonImg,i.NgClass,i.NgIf],styles:[".icon[_ngcontent-%COMP%]{width:2.5em;height:2.5em;vertical-align:-.15em;fill:currentColor;overflow:hidden}ion-list-header[_ngcontent-%COMP%]{height:3rem;background:#f5f6fa;font-size:.8rem}.search-icon[_ngcontent-%COMP%]{width:2em;height:2em;vertical-align:-.65em;fill:currentColor;overflow:hidden;margin-right:.25rem;margin-left:.25rem}ion-grid[_ngcontent-%COMP%]{--ion-grid-padding:0}ion-col[_ngcontent-%COMP%]{--ion-grid-column-padding:0;text-align:center}ion-thumbnail[_ngcontent-%COMP%]{width:6rem!important;height:4rem!important;position:relative}.time[_ngcontent-%COMP%]{position:absolute;width:100%;background:rgba(29,29,31,.5);bottom:0;color:#fff;font-weight:700}.badge[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{text-align:center;font-size:.8rem}.badge[_ngcontent-%COMP%]{display:inline-block;width:1.5rem;height:1.5rem;line-height:1.5rem;border-radius:5px}.badge.live[_ngcontent-%COMP%]{border:1px solid #4bb2ff;color:#4bb2ff}.badge.recorded[_ngcontent-%COMP%]{border:1px solid #52c41a;color:#52c41a}.badge.coming[_ngcontent-%COMP%]{border:1px solid #58626f;color:#58626f}ion-item-divider[_ngcontent-%COMP%]{font-size:.8rem;font-weight:700;color:#1d1d1f;line-height:3rem;background:#f5f6fa}"]}),e})()}];let M=(()=>{class e{}return e.\u0275mod=y["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=y["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.i.forChild(C)],a.i]}),e})();var E=n("Ql/B");n.d(t,"MyCoursePageModule",(function(){return T}));let T=(()=>{class e{}return e.\u0275mod=y["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=y["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.CommonModule,r.FormsModule,o.IonicModule,M,E.a]]}),e})()}}]);