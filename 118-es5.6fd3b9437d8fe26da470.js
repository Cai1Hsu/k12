function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{xwpR:function(e,t,n){"use strict";n.r(t);var r=n("ofXK"),i=n("3Pt+"),a=n("TEn/"),o=n("tyNb"),s=n("mrSG"),l=n("wd/R"),c=n("qXBG"),d=n("KCVp"),u=n("aBxd"),h=n("D+jN"),m=n("LWQN"),f=n("rttL"),p=n("h2Q0"),g=n("uwyt"),v=n("26ZW"),_=n("jMEw"),b=n("fXoL"),y=n("zxQZ");function x(e,t){if(1&e&&(b["\u0275\u0275elementContainerStart"](0),b["\u0275\u0275text"](1," \xa0\xa0"),b["\u0275\u0275elementStart"](2,"span"),b["\u0275\u0275text"](3),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementContainerEnd"]()),2&e){var n=b["\u0275\u0275nextContext"]().$implicit;b["\u0275\u0275advance"](2),b["\u0275\u0275classMapInterpolate1"]("badge ",n.type_class,""),b["\u0275\u0275advance"](1),b["\u0275\u0275textInterpolate"](n.type)}}var I=function(e,t){return{"color-000":e,"color-aaa":t}};function w(e,t){if(1&e){var n=b["\u0275\u0275getCurrentView"]();b["\u0275\u0275elementStart"](0,"ion-item",7),b["\u0275\u0275listener"]("click",(function(){b["\u0275\u0275restoreView"](n);var e=t.$implicit;return b["\u0275\u0275nextContext"](2).pick(e)})),b["\u0275\u0275elementStart"](1,"div",15),b["\u0275\u0275elementStart"](2,"div",16),b["\u0275\u0275elementStart"](3,"div",17),b["\u0275\u0275elementStart"](4,"ion-thumbnail"),b["\u0275\u0275element"](5,"ion-img",18),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](6,"div",19),b["\u0275\u0275text"](7),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](8,"div",20),b["\u0275\u0275elementStart"](9,"a",21),b["\u0275\u0275text"](10),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](11,"p",22),b["\u0275\u0275elementStart"](12,"span"),b["\u0275\u0275text"](13),b["\u0275\u0275elementEnd"](),b["\u0275\u0275text"](14,"\xa0\xa0|\xa0\xa0"),b["\u0275\u0275elementStart"](15,"span"),b["\u0275\u0275text"](16),b["\u0275\u0275elementEnd"](),b["\u0275\u0275text"](17," \xa0\xa0|\xa0\xa0"),b["\u0275\u0275elementStart"](18,"span"),b["\u0275\u0275text"](19),b["\u0275\u0275elementEnd"](),b["\u0275\u0275template"](20,x,4,4,"ng-container",23),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"]()}if(2&e){var r=t.$implicit;b["\u0275\u0275advance"](5),b["\u0275\u0275property"]("src",r.coverUrl),b["\u0275\u0275advance"](2),b["\u0275\u0275textInterpolate"](r.date),b["\u0275\u0275advance"](2),b["\u0275\u0275property"]("ngClass",b["\u0275\u0275pureFunction2"](8,I,3!=r.showType,3===r.showType)),b["\u0275\u0275advance"](1),b["\u0275\u0275textInterpolate"](r.title),b["\u0275\u0275advance"](3),b["\u0275\u0275textInterpolate"](r.teacher_name),b["\u0275\u0275advance"](3),b["\u0275\u0275textInterpolate"](r.classroom_name),b["\u0275\u0275advance"](3),b["\u0275\u0275textInterpolate"](r.num_of_day_name),b["\u0275\u0275advance"](1),b["\u0275\u0275property"]("ngIf",r.type)}}function k(e,t){if(1&e&&(b["\u0275\u0275elementContainerStart"](0),b["\u0275\u0275elementStart"](1,"ion-item-divider"),b["\u0275\u0275text"](2),b["\u0275\u0275elementEnd"](),b["\u0275\u0275template"](3,w,21,11,"ion-item",14),b["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit;b["\u0275\u0275advance"](2),b["\u0275\u0275textInterpolate1"](" ",n.day," "),b["\u0275\u0275advance"](1),b["\u0275\u0275property"]("ngForOf",n.list)}}var C,S,T=[{path:"",component:(C=function(){function e(t,n,r,i,a,o,s,l,c,h){_classCallCheck(this,e),this.router=t,this.auth=n,this.comm=r,this.ymsrv=i,this.osrv=a,this.utility=o,this.lpsrv=s,this.lplp=l,this.cache=c,this.pickerController=h,this.the_filter=new d.e,this.hasMore=!0,this.loading=!0,this.the_group=[],this.the_syllabus=[],this.the_video_filter=new u.d}return _createClass(e,[{key:"ngOnInit",value:function(){this.init()}},{key:"init",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.lplp.Token();case 2:return this.the_token=e.sent,e.next=5,this.auth.get_user();case 5:return this.user=e.sent,e.next=8,this.auth.is_teacher();case 8:return this.is_teacher=e.sent,e.next=11,this.auth.is_student();case 11:return this.is_student=e.sent,this.the_filter=new d.e,this.is_teacher?this.the_filter.teacherid=this.user.userCode:this.the_filter.studentid=this.user.userCode,this.the_filter.zixiornotzixi="2",this.the_filter.orderby=this.the_filter.eduyearid=this.the_filter.searchword=this.the_filter.courseclasscode="",e.next=18,this.load_timetable();case 18:case"end":return e.stop()}}),e,this)})))}},{key:"search",value:function(e){this.the_filter.PageIndex=1,this.load_timetable()}},{key:"load_timetable",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.the_group=[],this.the_filter.startTime=l(this.the_date).startOf("month").format("YYYY-MM-DD"),this.the_filter.endTime=l(this.the_date).endOf("month").format("YYYY-MM-DD"),e.next=5,this.initSyllabusList();case 5:return e.next=7,this.get_data();case 7:t=e.sent,_toConsumableArray(new Set(t.map((function(e){return e.the_date})))).forEach((function(e){n.the_group.push({day:l(e).format("YYYY\u5e74M\u6708D\u65e5"),list:t.filter((function(t){return t.the_date==e}))})}));case 9:case"end":return e.stop()}}),e,this)})))}},{key:"get_data",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.osrv.get_courseplan_time_table_range(this.the_filter,"");case 3:if(0==(t=e.sent).code){e.next=6;break}return e.abrupt("return",void(this.loading=!1));case 6:return n=t.data,e.next=9,this.initLivingRecordedVideo(_toConsumableArray(new Set(n.map((function(e){return e.teacherid})))));case 9:return r=e.sent,e.abrupt("return",(n.forEach((function(e){e.coverUrl=i.utility.getCover(e.courseclass_name);var t=i.the_syllabus.find((function(t){return t.section==parseInt(e.num_of_day)&&t.teacherId===e.teacherid&&l(t.date).isSame(l(e.the_date),"day")})),n=r.find((function(t){return t.teacherId==e.teacherid&&t.numOfDay==parseInt(e.num_of_day)&&l(t.startDate).isSame(l(e.the_date),"day")}));e.date=l(e.starttime).format("HH:mm")+"-"+l(e.endtime).format("HH:mm"),t?(e.title=t.sequence+t.name,t.tSort>0&&(e.title+="\uff08"+t.tSort+"\uff09"),e.showType=1,e.syllabus=t):n?(n.videoType===u.e.Live?l().isBetween(l(e.starttime),l(e.endtime),"seconds","[]")?(e.type="\u76f4",e.type_class="live"):(e.type="\u672a",e.type_class="coming"):(e.type="\u5f55",e.type_class="recorded"),e.title=n.title,e.showType=2,e.video=n):(e.title=e.name,e.showType=3)})),this.loading=!1,n));case 11:case"end":return e.stop()}}),e,this)})))}},{key:"initLivingRecordedVideo",value:function(e){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.the_token){t.next=2;break}return t.abrupt("return",[]);case 2:if(0!=e.length){t.next=4;break}return t.abrupt("return",[]);case 4:return this.the_video_filter.teacherId=e,this.the_video_filter.startDate=this.the_filter.startTime,this.the_video_filter.endDate=this.the_filter.endTime,t.next=7,this.lpsrv.get_live_recorded_list(this.the_video_filter,this.the_token);case 7:return n=t.sent,t.abrupt("return",0!=n.code?[]:n.data);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"initSyllabusList",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.the_token){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.lpsrv.get_syllabus_bydate(this.the_filter.startTime,this.the_filter.endTime,this.the_token);case 4:0==(t=e.sent).code&&(this.the_syllabus=t.data);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"load_more",value:function(e){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.the_filter.PageIndex+=1,t.next=3,this.get_data();case 3:if(t.t0=t.sent.length,0!=t.t0){t.next=8;break}this.hasMore=!1,e.target.disabled=!0,t.next=12;break;case 8:return t.next=10,this.get_data();case 10:n=t.sent,_toConsumableArray(new Set(n.map((function(e){return e.the_date})))).forEach((function(e){var t=r.the_group.find((function(t){return t.day==l(e).format("YYYY\u5e74M\u6708D\u65e5")}));t?t.list=t.list.concat(n.filter((function(t){return t.the_date==e}))):r.the_group.push({day:l(e).format("YYYY\u5e74M\u6708D\u65e5"),list:n.filter((function(t){return t.the_date==e}))})}));case 12:e.target.complete();case 13:case"end":return t.stop()}}),t,this)})))}},{key:"pick",value:function(e){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(3===e.showType){t.next=12;break}if(1!==e.showType){t.next=9;break}if(!this.is_student||1==e.syllabus.publicType||3==e.syllabus.publicType){t.next=4;break}return t.abrupt("return",void this.comm.presentToast("\u5bf9\u4e0d\u8d77\uff0c\u6559\u5e08\u672a\u516c\u5f00\u8be5\u8282\u8bfe\uff0c\u65e0\u6cd5\u67e5\u770b\uff01"));case 4:if(!this.is_teacher||1==e.syllabus.publicType||3==e.syllabus.publicType){t.next=6;break}return t.abrupt("return",void this.comm.presentToast("\u5bf9\u4e0d\u8d77\uff0c\u6559\u5e08\u672a\u516c\u5f00\u8be5\u8282\u8bfe\uff0c\u65e0\u6cd5\u67e5\u770b\uff01"));case 6:this.router.navigate(["features/learning-space/syllabus-view",{id:e.syllabus.syllabusId,teacherId:e.syllabus.teacherId,courseId:e.syllabus.courseId}]),t.next=10;break;case 9:2===e.showType&&(this.cache.set("livingRecorded",e.video),this.router.navigate(["course-plan/course-plan-detail"]));case 10:t.next=13;break;case 12:this.comm.presentToast("\u5bf9\u4e0d\u8d77\uff0c\u672a\u80fd\u627e\u5230\u8be5\u8282\u8bfe\u7684\u5f00\u8bfe\u4fe1\u606f\uff01");case 13:case"end":return t.stop()}}),t,this)})))}},{key:"openFilter",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[{text:"\u5168\u90e8",value:""}],e.next=3,this.comm.getYear();case 3:for(e.sent.forEach((function(e){n.push({text:e.name,value:e.id})})),r=[],i=1;i<=12;i++)r.push({text:i.toString()+"\u6708",value:i.toString()});return a=0,o=0,this.the_filter.startTime&&""!=this.the_filter.startTime&&(a=n.findIndex((function(e){return e.value==l(s.the_filter.startTime).format("YYYY")})),o=r.findIndex((function(e){return e.value==l(s.the_filter.startTime).format("M")}))),t.push({name:"1",selectedIndex:a,options:n},{name:"2",selectedIndex:o,options:r}),e.next=11,this.pickerController.create({buttons:[{role:"cancel",text:"\u53d6\u6d88",handler:function(){}},{text:"\u786e\u5b9a",handler:function(e){s.the_date=l(e[1].value+"-"+e[2].value+"-01").toDate(),s.the_filter.PageIndex=1,s.load_timetable()}}],columns:t});case 11:e.sent.present();case 12:case"end":return e.stop()}}),e,this)})))}}]),e}(),C.\u0275fac=function(e){return new(e||C)(b["\u0275\u0275directiveInject"](o.g),b["\u0275\u0275directiveInject"](c.a),b["\u0275\u0275directiveInject"](m.a),b["\u0275\u0275directiveInject"](_.a),b["\u0275\u0275directiveInject"](v.a),b["\u0275\u0275directiveInject"](p.a),b["\u0275\u0275directiveInject"](g.a),b["\u0275\u0275directiveInject"](f.a),b["\u0275\u0275directiveInject"](h.a),b["\u0275\u0275directiveInject"](a.PickerController))},C.\u0275cmp=b["\u0275\u0275defineComponent"]({type:C,selectors:[["app-my-course"]],decls:19,vars:5,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","tabs"],[1,"display-table","bgfff"],[1,"table-cell"],["placeholder","\u8f93\u5165\u5173\u952e\u8bcd\u641c\u7d22","debounce","500",3,"animated","ngModel","ionChange","ngModelChange"],[1,"table-cell",2,"width","3rem"],[3,"click"],["aria-hidden","true",1,"icon"],[0,"xlink","href","#iconInterface58-24px"],[3,"show","loading"],[4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","\u66f4\u591a..."],[3,"click",4,"ngFor","ngForOf"],[1,"display-table"],[1,"table-cell",2,"vertical-align","top","padding-top","1rem","width","5rem"],[2,"position","relative"],[3,"src"],[1,"time"],[1,"table-cell","padding-left-20","padding-top-20"],[1,"font-20","text-hidden-2",3,"ngClass"],[1,"color-8f92a1","font-16","mt10"],[4,"ngIf"]],template:function(e,t){1&e&&(b["\u0275\u0275elementStart"](0,"ion-header",0),b["\u0275\u0275elementStart"](1,"ion-toolbar"),b["\u0275\u0275elementStart"](2,"ion-buttons",1),b["\u0275\u0275element"](3,"ion-back-button",2),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](4,"ion-title"),b["\u0275\u0275text"](5,"\u6211\u7684\u8bfe\u7a0b"),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](6,"ion-content"),b["\u0275\u0275elementStart"](7,"div",3),b["\u0275\u0275elementStart"](8,"div",4),b["\u0275\u0275elementStart"](9,"ion-searchbar",5),b["\u0275\u0275listener"]("ionChange",(function(e){return t.search(e)}))("ngModelChange",(function(e){return t.the_filter.searchword=e})),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](10,"div",6),b["\u0275\u0275elementStart"](11,"a",7),b["\u0275\u0275listener"]("click",(function(){return t.openFilter()})),b["\u0275\u0275namespaceSVG"](),b["\u0275\u0275elementStart"](12,"svg",8),b["\u0275\u0275element"](13,"use",9),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275namespaceHTML"](),b["\u0275\u0275element"](14,"app-loading-process",10),b["\u0275\u0275elementStart"](15,"ion-list"),b["\u0275\u0275template"](16,k,4,2,"ng-container",11),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](17,"ion-infinite-scroll",12),b["\u0275\u0275listener"]("ionInfinite",(function(e){return t.load_more(e)})),b["\u0275\u0275element"](18,"ion-infinite-scroll-content",13),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"]()),2&e&&(b["\u0275\u0275advance"](9),b["\u0275\u0275property"]("animated",!0)("ngModel",t.the_filter.searchword),b["\u0275\u0275advance"](5),b["\u0275\u0275property"]("show",!t.the_group||0==t.the_group.length&&0==t.loading)("loading",!0===t.loading),b["\u0275\u0275advance"](2),b["\u0275\u0275property"]("ngForOf",t.the_group))},directives:[a.IonHeader,a.IonToolbar,a.IonButtons,a.IonBackButton,a.IonBackButtonDelegate,a.IonTitle,a.IonContent,a.IonSearchbar,a.TextValueAccessor,i.NgControlStatus,i.NgModel,y.a,a.IonList,r.NgForOf,a.IonInfiniteScroll,a.IonInfiniteScrollContent,a.IonItemDivider,a.IonItem,a.IonThumbnail,a.IonImg,r.NgClass,r.NgIf],styles:[".icon[_ngcontent-%COMP%]{width:2.5em;height:2.5em;vertical-align:-.15em;fill:currentColor;overflow:hidden}ion-list-header[_ngcontent-%COMP%]{height:3rem;background:#f5f6fa;font-size:.8rem}.search-icon[_ngcontent-%COMP%]{width:2em;height:2em;vertical-align:-.65em;fill:currentColor;overflow:hidden;margin-right:.25rem;margin-left:.25rem}ion-grid[_ngcontent-%COMP%]{--ion-grid-padding:0}ion-col[_ngcontent-%COMP%]{--ion-grid-column-padding:0;text-align:center}ion-thumbnail[_ngcontent-%COMP%]{width:6rem!important;height:4rem!important;position:relative}.time[_ngcontent-%COMP%]{position:absolute;width:100%;background:rgba(29,29,31,.5);bottom:0;color:#fff;font-weight:700}.badge[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{text-align:center;font-size:.8rem}.badge[_ngcontent-%COMP%]{display:inline-block;width:1.5rem;height:1.5rem;line-height:1.5rem;border-radius:5px}.badge.live[_ngcontent-%COMP%]{border:1px solid #4bb2ff;color:#4bb2ff}.badge.recorded[_ngcontent-%COMP%]{border:1px solid #52c41a;color:#52c41a}.badge.coming[_ngcontent-%COMP%]{border:1px solid #58626f;color:#58626f}ion-item-divider[_ngcontent-%COMP%]{font-size:.8rem;font-weight:700;color:#1d1d1f;line-height:3rem;background:#f5f6fa}"]}),C)}],M=((S=function e(){_classCallCheck(this,e)}).\u0275mod=b["\u0275\u0275defineNgModule"]({type:S}),S.\u0275inj=b["\u0275\u0275defineInjector"]({factory:function(e){return new(e||S)},imports:[[o.i.forChild(T)],o.i]}),S),E=n("Ql/B");n.d(t,"MyCoursePageModule",(function(){return j}));var O,j=((O=function e(){_classCallCheck(this,e)}).\u0275mod=b["\u0275\u0275defineNgModule"]({type:O}),O.\u0275inj=b["\u0275\u0275defineInjector"]({factory:function(e){return new(e||O)},imports:[[r.CommonModule,i.FormsModule,a.IonicModule,M,E.a]]}),O)}}]);