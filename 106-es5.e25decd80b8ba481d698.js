function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{lu3c:function(e,t,n){"use strict";n.r(t);var r,i,s=n("ofXK"),a=n("3Pt+"),o=n("TEn/"),l=n("tyNb"),u=n("mrSG"),c=n("qXBG"),d=n("LWQN"),m=n("AytR"),h=n("A7F3"),g=n("26ZW"),f=(n("ed2z"),n("itXk")),p=n("jMEw"),v=n("uJRU"),x=n("Oh4o"),b=n("fXoL"),C=n("e8h1"),k=[{path:"",component:(r=function(){function e(t,n,r,i,s,a,o,l,u,c,d){_classCallCheck(this,e),this.authService=t,this.router=n,this.route=r,this.storage=i,this.comm=s,this.appVersion=a,this.JPushPlugin=o,this.JanalyticsPlugin=l,this.osrv=u,this.ymsrv=c,this.ausrv=d,this.msg="",this.the_agreenment=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.route.url.subscribe((function(t){e.authService.clear()}))}},{key:"login",value:function(e){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i,s,a,o,l,c,d,h=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.the_agreenment){t.next=54;break}return t.next=3,this.comm.loadingPresent("\u767b\u5f55\u4e2d......");case 3:return n=t.sent,t.next=6,this.authService.login(e.value);case 6:if(0!=(r=t.sent).code){t.next=50;break}if(i=r.data.accessToken,!r.data||!i||null==i||null==i){t.next=47;break}return t.next=12,this.authService.user_info(i);case 12:if(0!=(a=t.sent).code){t.next=44;break}if(s=a.data,this.storage.set("UNIQUE_IDENTIFIER",a.data.uniqueIdentifier),!(s.roles&&s.roles.filter((function(e){return 1==e.userType})).length>0)){t.next=16;break}return t.abrupt("return",(n.dismiss(),void this.comm.presentToast("APP\u4e0d\u5141\u8bb8\u8d85\u7ea7\u7ba1\u7406\u5458\u767b\u5f55\uff01")));case 16:if(true || (o=s.roles&&s.roles.length>0&&s.roles.filter((function(e){return 1==e.userType||2==e.userType})).length>0)||""!=s.mobileNo&&null!=s.mobileNo&&null!=s.mobileNo){t.next=22;break}return n.dismiss(),t.next=21,this.comm.presentAlert("\u6e29\u99a8\u63d0\u793a",null,"\u60a8\u8fd8\u672a\u7ed1\u5b9a\u624b\u673a\uff0c\u4f7f\u7528APP\u524d\uff0c\u8bf7\u5148\u7ed1\u5b9a\u624b\u673a",[{text:"\u597d\u7684,\u53bb\u8bbe\u7f6e",handler:function(e){h.router.navigate(["bind-phone",{userid:s.userID,token:i}])}}]);case 21:return t.abrupt("return",void t.sent);case 22:if(true || !0!==s.isNeedResetPwd){t.next=27;break}return n.dismiss(),t.next=26,this.comm.presentAlert("\u6e29\u99a8\u63d0\u793a",null,"\u5e10\u53f7\u5b89\u5168\u7b49\u7ea7\u4f4e\uff0c\u8bf7\u4fee\u6539\u5bc6\u7801\uff01",[{text:"\u597d\u7684,\u53bb\u4fee\u6539",handler:function(e){h.router.navigate(["update-password",{userid:s.userID,token:i}])}}]);case 26:return t.abrupt("return",void t.sent);case 27:return l=s.roles&&s.roles.length>0&&s.roles.filter((function(e){return 7==e.userType})).length>0,c=s.roles&&s.roles.length>0&&s.roles.filter((function(e){return 4==e.userType})).length>0,d=o?s.roles.filter((function(e){return 1==e.userType||2==e.userType}))[0]:l?s.roles.filter((function(e){return 7==e.userType}))[0]:c?s.roles.filter((function(e){return 4==e.userType}))[0]:s.roles[0],t.next=31,this.storage.remove("USER_ROLE");case 31:return t.next=33,this.storage.set("USER_ROLE",d);case 33:return s.avatarUrl&&""!==s.avatarUrl&&null!=s.avatarUrl&&null!=s.avatarUrl||(s.avatarUrl=m.a.default_avatar),t.next=36,this.storage.set("ACCESS_TOKEN",i);case 36:return t.next=38,this.storage.set("USER_INFO",s);case 38:return t.next=40,this.storage.set("OPEN_NOTIFICATION",!0);case 40:try{this.JPushPlugin.initJPush(),this.JPushPlugin.resume(),setTimeout((function(){return Object(u.a)(h,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[s.serialNo,this.getUserCode(s.userID)],e.next=3,this.authService.is_all_teacher();case 3:if(e.t0=e.sent,e.t1=1==e.t0,!e.t1){e.next=7;break}t.push("teacher"+s.serialNo),t.push(this.getUserCode(s.userCode));case 7:return e.next=9,this.authService.is_student();case 9:if(e.t2=e.sent,1!=e.t2){e.next=20;break}return t.push("student"+s.serialNo),t.push(this.getUserCode(s.userCode)),e.next=14,this.osrv.get_student_full(s.userCode);case 14:return 0===(n=e.sent).code&&(n.data&&""!=n.data.classCode&&null!=n.data.classCode&&t.push(this.getUserCode(n.data.classCode)),n.data&&""!=n.data.gradeCode&&null!=n.data.gradeCode&&t.push(this.getUserCode(n.data.gradeCode))),e.next=18,this.ymsrv.get_teach_class({studentid:s.userCode});case 18:0===(r=e.sent).code&&r.data.length>0&&r.data.forEach((function(e){t.push(e.id)}));case 20:this.JPushPlugin.setTags(t);case 21:case"end":return e.stop()}}),e,this)})))}),2e4),setTimeout((function(){}),3e4)}catch(g){}this.JanalyticsPlugin.login(!0),this.ausrv.check(),this.router.navigate(["tabs"],{replaceUrl:!0,skipLocationChange:!0}),t.next=45;break;case 44:this.comm.presentToast(a.msg),this.JanalyticsPlugin.login(!1);case 45:t.next=48;break;case 47:this.comm.presentToast(r.msg),this.JanalyticsPlugin.login(!1);case 48:t.next=51;break;case 50:this.comm.presentToast(r.msg),this.JanalyticsPlugin.login(!1);case 51:n.dismiss(),t.next=55;break;case 54:this.comm.presentToast("\u8bf7\u5148\u9605\u8bfb\u5e76\u540c\u610f\u201c\u6570\u5b57\u6821\u56ed\u7528\u6237\u9690\u79c1\u534f\u8bae\u201d");case 55:case"end":return t.stop()}}),t,this)})))}},{key:"getUserCode",value:function(e){return e.replace(/-/gi,"")}},{key:"open_agreement",value:function(){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.the_agreenment=!0,this.router.navigate(["/login/agreement"]);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"findPassword",value:function(){this.router.navigate(["find-password"])}}]),e}(),r.\u0275fac=function(e){return new(e||r)(b["\u0275\u0275directiveInject"](c.a),b["\u0275\u0275directiveInject"](l.g),b["\u0275\u0275directiveInject"](l.a),b["\u0275\u0275directiveInject"](C.b),b["\u0275\u0275directiveInject"](d.a),b["\u0275\u0275directiveInject"](v.a),b["\u0275\u0275directiveInject"](h.a),b["\u0275\u0275directiveInject"](f.a),b["\u0275\u0275directiveInject"](g.a),b["\u0275\u0275directiveInject"](p.a),b["\u0275\u0275directiveInject"](x.a))},r.\u0275cmp=b["\u0275\u0275defineComponent"]({type:r,selectors:[["app-login"]],decls:29,vars:2,consts:[[2,"padding","40px"],["id","container"],["src","../../../assets/images/logo@2x.png","width","120px"],[2,"margin-top","40px"],[3,"ngSubmit"],["form","ngForm"],[1,"ion-no-padding","ion-text-sm-left"],["name","person-outline","size","small","color","primary"],["name","name","type","text","placeholder","\u7528\u6237\u540d/\u624b\u673a","ngModel","","required",""],["name","key-outline","size","small","color","primary"],["name","password","type","password","placeholder","\u5bc6\u7801","ngModel","","required",""],["lines","none",1,"ion-no-padding","ion-text-sm-left"],["name","agreement",3,"ngModel","ngModelChange"],[2,"font-size","small","color","gray",3,"click"],[1,"mt20","bgfff",2,"min-height","3rem"],["type","submit","expand","block","color","primary"],["color","medium","slot","end",2,"font-size","smaller","padding","0","margin","0",3,"click"]],template:function(e,t){if(1&e){var n=b["\u0275\u0275getCurrentView"]();b["\u0275\u0275elementStart"](0,"ion-content",0),b["\u0275\u0275elementStart"](1,"div",1),b["\u0275\u0275element"](2,"img",2),b["\u0275\u0275elementStart"](3,"div",3),b["\u0275\u0275elementStart"](4,"form",4,5),b["\u0275\u0275listener"]("ngSubmit",(function(){b["\u0275\u0275restoreView"](n);var e=b["\u0275\u0275reference"](5);return t.login(e)})),b["\u0275\u0275elementStart"](6,"ion-list"),b["\u0275\u0275elementStart"](7,"ion-item",6),b["\u0275\u0275element"](8,"ion-icon",7),b["\u0275\u0275elementStart"](9,"ion-label"),b["\u0275\u0275text"](10,"\xa0"),b["\u0275\u0275elementEnd"](),b["\u0275\u0275element"](11,"ion-input",8),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](12,"ion-item",6),b["\u0275\u0275element"](13,"ion-icon",9),b["\u0275\u0275elementStart"](14,"ion-label"),b["\u0275\u0275text"](15,"\xa0"),b["\u0275\u0275elementEnd"](),b["\u0275\u0275element"](16,"ion-input",10),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](17,"ion-item",11),b["\u0275\u0275elementStart"](18,"ion-checkbox",12),b["\u0275\u0275listener"]("ngModelChange",(function(e){return t.the_agreenment=e})),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](19,"a",13),b["\u0275\u0275listener"]("click",(function(){return t.open_agreement()})),b["\u0275\u0275text"](20,"\xa0\u6211\u5df2\u9605\u8bfb\u5e76\u540c\u610f\u300a\u6570\u5b57\u6821\u56ed\u7528\u6237\u9690\u79c1\u534f\u8bae\u300b"),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](21,"div",14),b["\u0275\u0275elementStart"](22,"ion-button",15),b["\u0275\u0275text"](23,"\u767b\u5f55"),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](24,"ion-item",11),b["\u0275\u0275elementStart"](25,"a",16),b["\u0275\u0275listener"]("click",(function(){return t.findPassword()})),b["\u0275\u0275text"](26,"\u5fd8\u8bb0\u5bc6\u7801"),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementStart"](27,"p"),b["\u0275\u0275text"](28),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"](),b["\u0275\u0275elementEnd"]()}2&e&&(b["\u0275\u0275advance"](18),b["\u0275\u0275property"]("ngModel",t.the_agreenment),b["\u0275\u0275advance"](10),b["\u0275\u0275textInterpolate1"](" ",t.msg," "))},directives:[o.IonContent,a["\u0275angular_packages_forms_forms_y"],a.NgControlStatusGroup,a.NgForm,o.IonList,o.IonItem,o.IonIcon,o.IonLabel,o.IonInput,o.TextValueAccessor,a.NgControlStatus,a.NgModel,a.RequiredValidator,o.IonCheckbox,o.BooleanValueAccessor,o.IonButton],styles:["ion-content[_ngcontent-%COMP%]{--background:#fff!important}#container[_ngcontent-%COMP%]{text-align:center;position:absolute;font-size:smaller;left:0;right:0;top:40%;transform:translateY(-50%);padding:20px}#container[_ngcontent-%COMP%]   .ym-line[_ngcontent-%COMP%]{text-align:left;border-bottom:thin solid #d3d3d3;margin-bottom:20px}ion-checkbox[_ngcontent-%COMP%]{--size:12px}"]}),r)},{path:"agreement",loadChildren:function(){return n.e(105).then(n.bind(null,"sLiz")).then((function(e){return e.AgreementPageModule}))}}],y=((i=function e(){_classCallCheck(this,e)}).\u0275mod=b["\u0275\u0275defineNgModule"]({type:i}),i.\u0275inj=b["\u0275\u0275defineInjector"]({factory:function(e){return new(e||i)},imports:[[l.i.forChild(k)],l.i]}),i);n.d(t,"LoginPageModule",(function(){return I}));var _,I=((_=function e(){_classCallCheck(this,e)}).\u0275mod=b["\u0275\u0275defineNgModule"]({type:_}),_.\u0275inj=b["\u0275\u0275defineInjector"]({factory:function(e){return new(e||_)},imports:[[s.CommonModule,a.FormsModule,o.IonicModule,y]]}),_)}}]);
